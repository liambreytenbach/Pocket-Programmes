<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pocket Programmes</title>
  <style>
    body{font-family:Arial, sans-serif; margin:0; min-height:100vh; background:#0f1724; color:#e6eef6}
    .wrap{max-width:800px;margin:28px auto;padding:20px}
    h1{margin:0 0 20px 0;font-size:22px}
    .card{background:#182234;border-radius:12px;padding:20px;box-shadow:0 6px 24px rgba(0,0,0,0.6)}
    label{display:block;margin-top:12px;margin-bottom:4px;font-size:14px}
    input,textarea{width:100%;padding:8px;border-radius:6px;border:1px solid #333;background:#0b1220;color:#fff; resize:vertical}
    textarea{min-height:60px; overflow:auto; scrollbar-width:thin; scrollbar-color:#555 #182234;}
    textarea::-webkit-scrollbar { width: 10px; }
    textarea::-webkit-scrollbar-track { background: #182234; border-radius:6px;}
    textarea::-webkit-scrollbar-thumb { background: #555; border-radius:6px;}
    button, a.button-link{
      padding:10px 20px;
      border:none;
      border-radius:8px;
      background:#60a5fa;
      color:#04263b;
      cursor:pointer;
      font-weight:bold;
      text-decoration:none;
      display:inline-block;
      text-align:center;
      width:150px;
    }
    #result{margin-top:20px;text-align:center; display:flex; flex-direction:column; align-items:center; gap:12px;}
    .qr-border{background:#fff; display:inline-block; padding:8px; border-radius:12px;}
    .btn-row{display:flex; justify-content:center; gap:12px; margin-top:12px;}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Pocket Programme Form</h1>
    <div class="card">
      <label>Play Name</label>
      <input id="playName" type="text" placeholder="Enter Play Name" />

      <label>Theatre</label>
      <input id="theatre" type="text" value="Harold Pinter Theatre" />

      <label>Address</label>
      <input id="address" type="text" value="6 Panton Street, London, SW1Y 4DN" />

      <label>Website</label>
      <input id="website" type="text" value="https://www.haroldpintertheatre.co.uk/" />

      <label>Run Dates</label>
      <input id="rundates" type="text" value="11 September – 6 December 2025" />

      <label>Date of Performance</label>
      <input id="exactDate" type="text" placeholder="Enter exact date" />

      <label>Time of Performance</label>
      <input id="exactTime" type="text" placeholder="Enter exact time" />

      <label>Schedule</label>
      <textarea id="schedule">- Monday to Saturday: 7:30 PM
- Saturday Matinee: 2:30 PM
- Sunday: Dark</textarea>

      <label>Running Time</label>
      <input id="runtime" type="text" value="1 hour 45 minutes (no interval)" />

      <label>Age Guidance</label>
      <input id="age" type="text" value="12+" />

      <label>Ticket Prices</label>
      <input id="tickets" type="text" value="From £20 (subject to a £3.95 transaction fee)" />

      <label>Smoking</label>
      <input id="smoking" type="text" value="Smoking on stage" />

      <label>About the Play</label>
      <textarea id="about">"The Weir" is a modern Irish classic by Conor McPherson, first performed in 1997. 
Set in a rural Irish pub, the play unfolds as locals share ghost stories, leading to a revelation that changes their lives forever.</textarea>

      <label>Director</label>
      <input id="director" type="text" value="Conor McPherson" />

      <label>Cast</label>
      <textarea id="cast">- Brendan Gleeson as Jack
- Owen McDonnell as Brendan
- Seán McGinley as Jim
- Kate Phillips as Valerie
- Tom Vaughan-Lawlor as Finbar</textarea>

      <label>Synopsis</label>
      <textarea id="synopsis">On a stormy night in a remote Irish pub, four men gather to share stories. 
When Valerie, a newcomer, joins them, their tales take a supernatural turn, 
leading to an unexpected and haunting revelation.</textarea>

      <label>Booking Information</label>
      <textarea id="booking">Official Box Office: https://www.haroldpintertheatre.co.uk/shows/the-weir
Ticket Price: From £20
Age Guidance: 12+
Smoking: Smoking on stage</textarea>

      <label>Additional Information</label>
      <textarea id="resources"></textarea>

      <button id="generate">Generate Programme Page + QR</button>
    </div>
    <div id="result"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    function sanitize(str){
      return str.replace(/\s+/g,'_').replace(/[^a-zA-Z0-9_]/g,'');
    }

    const generateBtn = document.getElementById('generate');
    const resultDiv = document.getElementById('result');

    generateBtn.addEventListener('click', () => {
      const data = {
        playName: document.getElementById('playName').value || "Play",
        theatre: document.getElementById('theatre').value,
        address: document.getElementById('address').value,
        website: document.getElementById('website').value,
        rundates: document.getElementById('rundates').value,
        exactDate: document.getElementById('exactDate').value,
        exactTime: document.getElementById('exactTime').value,
        schedule: document.getElementById('schedule').value,
        runtime: document.getElementById('runtime').value,
        age: document.getElementById('age').value,
        tickets: document.getElementById('tickets').value,
        smoking: document.getElementById('smoking').value,
        about: document.getElementById('about').value,
        director: document.getElementById('director').value,
        cast: document.getElementById('cast').value,
        synopsis: document.getElementById('synopsis').value,
        booking: document.getElementById('booking').value,
        resources: document.getElementById('resources').value
      };

      let htmlContent = `<!doctype html><html><head><meta charset="utf-8"><title>Pocket Programmes</title>
<style>body{font-family:Arial,sans-serif;background:#0f1724;color:#e6eef6;padding:20px}h1{font-size:24px}pre{white-space:pre-wrap;word-wrap:break-word}</style></head><body>
<h1>${data.playName} – Theatre Programme</h1><pre>`;
      htmlContent += `============================\nTheatre Programme: ${data.playName}\n============================\n\n`;
      htmlContent += `Venue Details:\n--------------\nTheatre: ${data.theatre}\nAddress: ${data.address}\nWebsite: ${data.website}\n\n`;
      htmlContent += `Performance Dates:\n------------------\nRun Dates: ${data.rundates}\nDate: ${data.exactDate}\nTime: ${data.exactTime}\nSchedule:\n${data.schedule}\nRunning Time: ${data.runtime}\nAge Guidance: ${data.age}\nTicket Prices: ${data.tickets}\nSmoking: ${data.smoking}\n\n`;
      htmlContent += `About the Play:\n---------------\n${data.about}\n\n`;
      htmlContent += `Cast & Creative Team:\n--------------------\nDirector: ${data.director}\nCast:\n${data.cast}\n\n`;
      htmlContent += `Synopsis:\n---------\n${data.synopsis}\n\n`;
      htmlContent += `Booking Information:\n-------------------\n${data.booking}\n\n`;
      htmlContent += `Additional Information:\n---------------------\n${data.resources}\n`;
      htmlContent += `</pre></body></html>`;

      const pageFilename = `${sanitize(data.playName)}_${sanitize(data.theatre)}.html`;
      const githubPagesUrl = `https://liambreytenbach.github.io/Pocket-Programmes/programmes/${pageFilename}`;

      const pageBlob = new Blob([htmlContent], { type: 'text/html' });
      const pageUrl = URL.createObjectURL(pageBlob);

      resultDiv.innerHTML = '';

      // QR code container
      const qrDiv = document.createElement('div');
      qrDiv.className = 'qr-border';
      resultDiv.appendChild(qrDiv);
      const qr = new QRCode(qrDiv, {
        text: githubPagesUrl,
        width: 220,
        height: 220
      });

      // Buttons row
      const btnRow = document.createElement('div');
      btnRow.className = 'btn-row';
      resultDiv.appendChild(btnRow);

      // Download Programme Page button
      const downloadLink = document.createElement('a');
      downloadLink.href = pageUrl;
      downloadLink.download = pageFilename;
      downloadLink.textContent = 'Download Programme Page';
      downloadLink.className = 'button-link';
      btnRow.appendChild(downloadLink);

      // Download QR Code button
      const qrDownloadBtn = document.createElement('button');
      qrDownloadBtn.textContent = 'Download QR Code';
      qrDownloadBtn.addEventListener('click', () => {
        const qrImg = qrDiv.querySelector('img');
        if(qrImg){
          const link = document.createElement('a');
          link.href = qrImg.src;
          link.download = `${sanitize(data.playName)}_${sanitize(data.theatre)}_QR.png`;
          link.click();
        }
      });
      btnRow.appendChild(qrDownloadBtn);
    });
  </script>
</body>
</html>
